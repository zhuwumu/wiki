<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java全栈知识体系</title>
    <meta name="description" content="日常笔记整理">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/wiki/assets/style.DZPax-ZG.css" as="style">
    <link rel="preload stylesheet" href="/wiki/vp-icons.css" as="style">
    
    <script type="module" src="/wiki/assets/app.CZCL_pHY.js"></script>
    <link rel="preload" href="/wiki/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/wiki/assets/chunks/theme.DFwwS_wP.js">
    <link rel="modulepreload" href="/wiki/assets/chunks/framework.6NRZc4eo.js">
    <link rel="modulepreload" href="/wiki/assets/01.后端技术栈_数据库_Redis.md.DfolwWU3.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/wiki/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/wiki/logo.ico" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>Java全栈知识体系</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/JAVA%E5%9F%BA%E7%A1%80.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>后端</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/02.%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/JavaScript.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>前端</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%84%9A%E6%89%8B%E6%9E%B6.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>后台管理系统脚手架</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/03.%E5%B7%A5%E5%85%B7-%E9%83%A8%E7%BD%B2/linux%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>工具|部署</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/06.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/0-%E7%AE%80%E4%BB%8B.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>设计模式</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-dc692963 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-cf11d7a2><span class="text" data-v-cf11d7a2><!----><span data-v-cf11d7a2>方法论</span><span class="vpi-chevron-down text-icon" data-v-cf11d7a2></span></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><div class="items" data-v-b98bc113><!--[--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/wiki/04.%E6%96%B9%E6%B3%95%E8%AE%BA/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83.html" data-v-35975db6><!--[--><span data-v-35975db6>代码规范</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b98bc113 data-v-35975db6><a class="VPLink link" href="/wiki/04.%E6%96%B9%E6%B3%95%E8%AE%BA/%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B.html" data-v-35975db6><!--[--><span data-v-35975db6>开发流程</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/wiki/05.%E6%9E%B6%E6%9E%84/%E6%9E%B6%E6%9E%84.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>架构</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>后端</h2><!----></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/JAVA%E5%9F%BA%E7%A1%80.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>JAVA基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/SpringBoot.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>SpringBoot</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 has-active" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h3 class="text" data-v-b7550ba0>设计模式</h3><!----></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Redis</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h3 class="text" data-v-b7550ba0>数据库</h3><!----></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Redis</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/Kafka.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Kafka</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/netty.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Netty</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/Zookeeper.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Zookeeper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%9E%B6%E6%9E%84300%E8%AE%B2.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>架构300讲</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _wiki_01_%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88_%E6%95%B0%E6%8D%AE%E5%BA%93_Redis" data-v-39a288b8><div><h3 id="_1、redis实现分布式锁-redisson" tabindex="-1">1、redis实现分布式锁(redisson) <a class="header-anchor" href="#_1、redis实现分布式锁-redisson" aria-label="Permalink to &quot;1、redis实现分布式锁(redisson)&quot;">​</a></h3><p><a href="https://tencentcloud.csdn.net/676397acf3b8a55e4e98e05d.html" target="_blank" rel="noreferrer">https://tencentcloud.csdn.net/676397acf3b8a55e4e98e05d.html</a></p><p><a href="https://cloud.tencent.com/developer/article/2308353" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/2308353</a></p><p>使用setnx命令加锁，导致如下问题</p><ul><li>未释放锁，导致死锁；**解决方案：**设置过期时间。</li><li>设置的过期时间小于业务执行时间，导致锁过期；**解决方案：**客户端开启守护线程（watch dog）为锁续期。</li><li>解锁时，未检查锁的归属，释放了别人的锁；**解决方案：**设置锁时，key加入唯一标识，Lua脚本，先判断锁是否属于自己，再Del释放锁。</li></ul><p><strong>Redisson解决了锁的可重入和续期问题。</strong></p><p>Redisson在redis单机下可以解决以上分布式问题，但正式环境下，redis主从集群+哨兵模式下，如果部分节点加锁失败，主从未同步成功（主从异步同步），会导致加锁失败。</p><p>解决方案：RedLock实现高可靠的分布式锁。</p><p>出现节点崩溃重启，会出现多个客户端持有锁</p><p>解决方案：节点崩溃后，不立即重启，而是等待一段时间再重启，等待的时间大于锁的有效时间。通过人为补偿的方式，降低不一致发生的概率。</p><p>RedLock缺点：</p><ul><li><strong>性能问题</strong>：RedLock 要等待大多数节点返回之后，才能加锁成功，而这个过程中可能会因为网络问题，或节点超时的问题，影响加锁的性能。</li><li><strong>并发安全性问题</strong>：当客户端加锁时，如果遇到 GC 可能会导致加锁失效，但 GC 后误认为加锁成功的安全事故</li></ul><p><strong>RedLock已经逐渐被废弃？</strong></p><p><strong>redis 红锁被抛弃后用什么代替</strong> ？</p><p><a href="https://blog.51cto.com/u_12187/12246223" target="_blank" rel="noreferrer">https://blog.51cto.com/u_12187/12246223</a></p><p>Redisson源码分析</p><p>watch dog：</p><p>自旋阻塞、唤醒机制保证高性能：</p><p>Netty中TimerTask，时间轮：</p><p>方法嵌套，递归，中间件里很常用的一种定时任务实现：</p><p>观察者模式（发布-订阅）</p><h3 id="_2、redis用于哪些场景" tabindex="-1">2、redis用于哪些场景？ <a class="header-anchor" href="#_2、redis用于哪些场景" aria-label="Permalink to &quot;2、redis用于哪些场景？&quot;">​</a></h3><ul><li><p>String</p><ul><li>登录鉴权，验证码、token失效</li><li>防刷，设置过期时间</li></ul></li><li><p>list</p><ul><li>消息队列，电商秒杀、集中约课等高并发写场景下</li><li>浏览器历史记录。通过list实现栈功能，进而实现浏览器历史记录场景；<code>lpush</code>、<code>lpop</code></li></ul></li><li><p>Set数据类型，天然去重的集合，提供了求交集、并集等一系列方法，适合共同或单方面好友、粉丝、爱好之类的业务</p><ul><li>抽奖设计</li><li>点赞收藏设计，粉丝关注</li><li>社交系统中好友关系设计</li><li>用户签到</li></ul></li><li><p>Zset</p><p>具备高性能的原因有二</p><ol><li>用空间换时间的预计算思想</li><li>优秀的底层数据结构，通过skiplist（跳表）+ dict（哈希表）+ listpack实现的</li></ol><ul><li>排行榜</li></ul></li><li><p>bitMaps（位图）</p><p>用户签到虽然Set也可以实现，但用户量庞大的情况下，会极大占用内存空间，使用bitmap，通过bit位来进行状态存储。</p></li><li><p>HyperLogLog</p><p>提供不精确的去重方案，标准误差0.8%，但仅仅占用12K的内存空间</p><p>网站UV（Unique Visitor）统计；与PV（page Visitor）不同的是需要去重，虽然Set也可以，但是极消耗内存。</p></li><li><p>地理空间索引GEO</p><p>用于存储地理位置信息，并支持基于地理位置的查询和计算</p></li><li><p>计数器：帖子点赞、收藏、电商的库存扣减</p></li><li><p>分布式锁。setnx</p></li></ul><h3 id="_3、-redis缓存穿透、缓存击穿、缓存雪崩" tabindex="-1">3、 redis缓存穿透、缓存击穿、缓存雪崩 <a class="header-anchor" href="#_3、-redis缓存穿透、缓存击穿、缓存雪崩" aria-label="Permalink to &quot;3、 redis缓存穿透、缓存击穿、缓存雪崩&quot;">​</a></h3><ol><li><p>缓存穿透</p><p>透意味着没有命中redis，直接打到数据库上，比如不存在的id值等。</p><ul><li>布隆过滤器。核心思想：当某个值存在时，这个值不一定存在；当某个值不存在时，那么这个值一定不存在。</li></ul></li><li><p>缓存击穿</p><p>击意味着命中了redis，但redis同时失效，导致直接打到数据库上。</p><ul><li>设置不同的过期时间，相对分散一些</li><li>添加降级限流操作，给出友好提示</li></ul></li><li><p>缓存雪崩</p><p>原因：redis的不可用，和缓存击穿类似，导致数据全部打到mysql导致的。</p><ul><li>保证redis高可用，搭建多节点cluster集群，或者搭建简单的哨兵集群</li><li>设置限流降级功能，请求先达到web服务器，然后再进入redis，对多余的请求进行一个平滑的降级，比如给一个友好的提示页面</li><li>使用mq。将请求加入到mq队列中，然后异步告知用户前面还有多少人在排队，让用户等待</li><li>上线前对redis进行压测，对redis进行数据备份，合理的设置JVM服务的个数，mysql的架构等</li><li>redis内部进行优化，如解决bigkey问题，批量的操作数据，合理选择数据类型</li></ul></li></ol><h3 id="_4、redis多级缓存" tabindex="-1">4、redis多级缓存 <a class="header-anchor" href="#_4、redis多级缓存" aria-label="Permalink to &quot;4、redis多级缓存&quot;">​</a></h3><ul><li><p>使用本地缓存做一级缓存Ecache、guava、caffeine。使用redis做二级远程缓存。</p></li><li><p>对于一些变更频率较高的数据，采用集中式缓存，这样能够确保所有节点在数据变化后实时更新，从而保证数据的一致性。</p></li><li><p>对于一些极少变更的数据（如系统配置项）或者是一些对短期一致性要求不高的数据（如用户昵称、签名等）采用本地缓存，显著降低对远程集中式缓存的网络IO次数，提高系统性能。</p></li></ul><h3 id="_5、如何保证mysql和redis中的数据一致性" tabindex="-1">5、如何保证Mysql和redis中的数据一致性？ <a class="header-anchor" href="#_5、如何保证mysql和redis中的数据一致性" aria-label="Permalink to &quot;5、如何保证Mysql和redis中的数据一致性？&quot;">​</a></h3><ol><li><p>数据不一致原因</p><p>分布式场景中，并发带来的问题，网络抖动带来的问题，分布式事务不一致问题等。</p></li><li><p>数据不一致解决方案：</p><ul><li>延迟双删（不推荐）。不能完全解决，只能减少这种数据不一致概率的事件发生，适用于读多写少的场景，如商品首页等。</li><li>消息队列。</li><li>分布式锁。</li><li>canal同步。原理类似mysql的主从复制原理，伪装成一个从节点，监听mysql的binlog日志，然后将执行的mysql的操作。</li></ul></li></ol><h3 id="_6、redis的key淘汰策略-8种-内存满了怎么办" tabindex="-1">6、redis的key淘汰策略（8种）|内存满了怎么办？ <a class="header-anchor" href="#_6、redis的key淘汰策略-8种-内存满了怎么办" aria-label="Permalink to &quot;6、redis的key淘汰策略（8种）|内存满了怎么办？&quot;">​</a></h3><p><strong>LRU 算法和 LFU算法</strong></p><p>可能同学们会觉得LRU和LFU两种算法容易混淆，我在这⾥解释⼀下。</p><p>如果有⼀条许久不曾被访问的冷数据，偶然间被访问了⼀次，如果按照LRU算法的规则，这条数据就会 被定义为热数据，短期内不会被淘汰。</p><p>但按照LFU算法的规则，这条数据可能仍然是最近⼀段时间内被访问频率最低的，还是会被淘汰掉的。</p><p><strong>LRU关注于“最近是否被访问”，LFU关注于“最近的访问频率如何”，相对⽽⾔，后者的实现⽅式更加合 理⼀些。</strong></p><ol><li><p>noeviction（默认）：到达maxmemory值时，不淘汰任何数据。当内存超限时，写操作会返回错误，而读操作则正常执行。这种策略适合数据量不大，作为DB存储使用的情况。</p></li><li><p>volatile-lru：通过近似LRU算法，淘汰key，key的范围是设置了过期时间的key，可以区分冷热数据。</p><p>标准的LRU算法是双向链表+hash表，双向链表的插入和删除操作的时间复杂度都是O(1)，hash表的查找的时间复杂度是O(1)，两者结合，堪称完美。</p><p>采用近似LRU算法的原因：</p><ol><li>redis内部只实现了hash表，需要额外实现双线链表，内存消耗的代价不可接受。</li><li>每个redis请求，LRU的双向链表需要进行同步操作，这种实现方式对性能影响不小。</li></ol><p>redis近似LRU算法，虽然没有付出大的内存和性能代价，但牺牲了一些内存淘汰的准确率。</p><p>具体实现：</p><ol><li>采用LRU时钟值的方式，记录数据每次被访问的时间。</li><li>淘汰池概念</li><li>批次数据的数量是由参数maxmemory-samples参数设置的，该参数值越大，则淘汰准确率越高，但会增加CPU消耗</li><li>从待淘汰数据池中，淘汰掉空闲时间最⼤的那条数据，同时会根据Redis中的惰性删除配置，来决 定在Redis字典中执⾏同步删除还是异步删除。</li></ol></li><li><p>volatile-lfu：通过LFU算法，淘汰key，key的范围是设置了过期时间的key，能够区分冷热数据。</p></li><li><p>volatile-ttl：淘汰redis中剩余时间最短的key，key的范围是设置了过期时间的key，适合按时间区分冷热数据。</p></li><li><p>volatile-random：以随机的方式淘汰redis中的key，key的范围是设置了过期时间的key。</p></li><li><p>allkeys-lru：key的范围是所有的key</p></li><li><p>allkeys-lfu：key的范围是所有的key</p></li><li><p>allkeys-random：key的范围是所有的key</p></li></ol><p><strong>注：</strong></p><p>LRU：least recently used，最近最少使用，用当前时间减去上一次使用时间，值越大越先被删除。</p><p>LFU：least Frequently used，最不常用，统计每个key的访问频率，值越小越先被删除。</p><p>ttl：time to live，健值对的过期时间</p><p>volatile ：/ˈvɑːlətl/不稳定的</p><blockquote><p>淘汰策略的使用建议</p></blockquote><ol><li>优先使用allkeys-lru策略，充分利用LRU算法的优势，把最近最常访问的数据留在缓存中。如果有明显的冷热数据区分，建议使用。</li><li>如果业务中数据访问频率差别，没有冷热数据区分，建议使用allkeys-random，随机选择淘汰。</li><li>如果业务中有置顶需求，可以使用volatile-lru策略，同时置顶数据不设置过期时间，这些数据就一直不被删除，会淘汰其他设置过期时间的数据。</li><li>如果业务中有短时高频访问的数据，可以使用allkeys-lfu或volatile-lfu策略。</li></ol><h3 id="主从架构数据同步一致性原理" tabindex="-1">主从架构数据同步一致性原理 <a class="header-anchor" href="#主从架构数据同步一致性原理" aria-label="Permalink to &quot;主从架构数据同步一致性原理&quot;">​</a></h3><p><a href="https://xie.infoq.cn/article/85b537627355b21b02760f306" target="_blank" rel="noreferrer">https://xie.infoq.cn/article/85b537627355b21b02760f306</a></p><h3 id="redis-基本数据类型-采用的底层数据结构" tabindex="-1">redis 基本数据类型 采用的底层数据结构 <a class="header-anchor" href="#redis-基本数据类型-采用的底层数据结构" aria-label="Permalink to &quot;redis 基本数据类型 采用的底层数据结构&quot;">​</a></h3></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Mysql</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/wiki/01.%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88/Kafka.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Kafka</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"01.后端技术栈_java基础.md\":\"D5A4lMTW\",\"01.后端技术栈_java重点难点.md\":\"BwADrwnZ\",\"01.后端技术栈_kafka.md\":\"C9rTmi9I\",\"01.后端技术栈_netty.md\":\"tcCkSZBC\",\"01.后端技术栈_springboot.md\":\"795XN6H2\",\"01.后端技术栈_zookeeper.md\":\"BJ0qepOL\",\"01.后端技术栈_数据库_mysql.md\":\"CmjdHN6x\",\"01.后端技术栈_数据库_redis.md\":\"DfolwWU3\",\"01.后端技术栈_架构300讲.md\":\"EU16Gnp-\",\"01.后端技术栈_算法.md\":\"fq0q9qOZ\",\"02.前端技术栈_html.md\":\"DcrQSap6\",\"02.前端技术栈_javascript.md\":\"BmPWxow0\",\"03.工具-部署_linux运维笔记.md\":\"C_GtW9b1\",\"03.工具-部署_window.md\":\"Bp-iNpED\",\"03.工具-部署_工具-部署.md\":\"jMD1XJE3\",\"03.工具-部署_常见单词.md\":\"C1FjXz4Z\",\"03.工具-部署_收藏目录.md\":\"CkpxESvF\",\"04.方法论_代码规范.md\":\"DVxJ4ckn\",\"04.方法论_开发流程.md\":\"DfgMna4y\",\"05.架构_架构.md\":\"ggx3mI3B\",\"06.设计模式_0-简介.md\":\"B9dIIvoA\",\"06.设计模式_1-单例模式.md\":\"BiD7wnn-\",\"06.设计模式_10-桥接模式.md\":\"CHIDkp-B\",\"06.设计模式_11-组合模式.md\":\"vw7JXSZm\",\"06.设计模式_12-享元模式.md\":\"DdAj1yOy\",\"06.设计模式_13-观察者模式.md\":\"DiHU26sq\",\"06.设计模式_14-策略模式.md\":\"E5QDLZRf\",\"06.设计模式_15-命令模式.md\":\"D6uCeJJG\",\"06.设计模式_16-中介者模式.md\":\"BK-sg1vK\",\"06.设计模式_17-备忘录模式.md\":\"CKhtR75h\",\"06.设计模式_18-模板方法模式.md\":\"BzkUNNC8\",\"06.设计模式_19-迭代器模式.md\":\"BpxKAJL4\",\"06.设计模式_2-工厂方法模式.md\":\"BzECwxwn\",\"06.设计模式_20-状态模式.md\":\"Dkst2Dl4\",\"06.设计模式_21-责任链模式.md\":\"BykNgM-C\",\"06.设计模式_22-解释器模式.md\":\"Ce1Qnx-0\",\"06.设计模式_23-访问者模式.md\":\"CU9tLFPu\",\"06.设计模式_3-抽象工厂模式.md\":\"OsyBOBIi\",\"06.设计模式_4-建造者模式.md\":\"BnFgjucB\",\"06.设计模式_5-原型模式.md\":\"D1DIXN7K\",\"06.设计模式_6-适配器模式.md\":\"CAvtZU2g\",\"06.设计模式_7-代理模式.md\":\"C7JOdJ8n\",\"06.设计模式_8-装饰模式.md\":\"Bxcf4CSQ\",\"06.设计模式_9-外观模式.md\":\"BvEHLV-q\",\"api-examples.md\":\"C917TlFF\",\"index.md\":\"-6Qw_2fA\",\"markdown-examples.md\":\"DI9kNWJt\",\"后台管理系统脚手架.md\":\"BID13MPs\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Java全栈知识体系\",\"description\":\"日常笔记整理\",\"base\":\"/wiki/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.ico\",\"outline\":\"deep\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"后端\",\"link\":\"/01.后端技术栈/JAVA基础.md\"},{\"text\":\"前端\",\"link\":\"/02.前端技术栈/JavaScript.md\"},{\"text\":\"后台管理系统脚手架\",\"link\":\"/后台管理系统脚手架\"},{\"text\":\"工具|部署\",\"link\":\"/03.工具-部署/linux运维笔记\"},{\"text\":\"设计模式\",\"link\":\"/06.设计模式/0-简介\"},{\"text\":\"方法论\",\"items\":[{\"text\":\"代码规范\",\"link\":\"/04.方法论/代码规范\"},{\"text\":\"开发流程\",\"link\":\"/04.方法论/开发流程\"}]},{\"text\":\"架构\",\"link\":\"/05.架构/架构\"}],\"sidebar\":{\"/01.后端技术栈/\":[{\"text\":\"后端\",\"items\":[{\"text\":\"JAVA基础\",\"link\":\"/01.后端技术栈/JAVA基础.md\"},{\"text\":\"SpringBoot\",\"link\":\"/01.后端技术栈/SpringBoot.md\"},{\"text\":\"设计模式\",\"items\":[{\"text\":\"Mysql\",\"link\":\"/01.后端技术栈/数据库/Mysql.md\"},{\"text\":\"Redis\",\"link\":\"/01.后端技术栈/数据库/Redis.md\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"Mysql\",\"link\":\"/01.后端技术栈/数据库/Mysql.md\"},{\"text\":\"Redis\",\"link\":\"/01.后端技术栈/数据库/Redis.md\"}]},{\"text\":\"Kafka\",\"link\":\"/01.后端技术栈/Kafka.md\"},{\"text\":\"Netty\",\"link\":\"/01.后端技术栈/netty.md\"},{\"text\":\"Zookeeper\",\"link\":\"/01.后端技术栈/Zookeeper.md\"},{\"text\":\"架构300讲\",\"link\":\"/01.后端技术栈/架构300讲.md\"}]}],\"/06.设计模式/\":[{\"text\":\"设计模式\",\"items\":[{\"text\":\"0-简介\",\"link\":\"/06.设计模式/0-简介\"},{\"text\":\"1-单例模式\",\"link\":\"/06.设计模式/1-单例模式\"},{\"text\":\"2-工厂方法模式\",\"link\":\"/06.设计模式/2-工厂方法模式\"},{\"text\":\"3-抽象工厂模式\",\"link\":\"/06.设计模式/3-抽象工厂模式\"},{\"text\":\"4-建造者模式\",\"link\":\"/06.设计模式/4-建造者模式\"},{\"text\":\"5-原型模式\",\"link\":\"/06.设计模式/5-原型模式\"},{\"text\":\"6-适配器模式\",\"link\":\"/06.设计模式/6-适配器模式\"},{\"text\":\"7-代理模式\",\"link\":\"/06.设计模式/7-代理模式\"},{\"text\":\"8-装饰模式\",\"link\":\"/06.设计模式/8-装饰模式\"},{\"text\":\"*9-外观模式\",\"link\":\"/06.设计模式/9-外观模式\"},{\"text\":\"10-桥接模式\",\"link\":\"/06.设计模式/10-桥接模式\"},{\"text\":\"11-组合模式\",\"link\":\"/06.设计模式/11-组合模式\"},{\"text\":\"12-享元模式\",\"link\":\"/06.设计模式/12-享元模式\"},{\"text\":\"*13-观察者模式\",\"link\":\"/06.设计模式/13-观察者模式\"},{\"text\":\"*14-策略模式\",\"link\":\"/06.设计模式/14-策略模式\"},{\"text\":\"15-命令模式\",\"link\":\"/06.设计模式/15-命令模式\"},{\"text\":\"16-中介者模式\",\"link\":\"/06.设计模式/16-中介者模式\"},{\"text\":\"17-备忘录模式\",\"link\":\"/06.设计模式/17-备忘录模式\"},{\"text\":\"18-模板方法模式\",\"link\":\"/06.设计模式/18-模板方法模式\"},{\"text\":\"19-迭代器模式\",\"link\":\"/06.设计模式/19-迭代器模式\"},{\"text\":\"20-状态模式\",\"link\":\"/06.设计模式/20-状态模式\"},{\"text\":\"*21-责任链模式\",\"link\":\"/06.设计模式/21-责任链模式\"},{\"text\":\"22-解释器模式\",\"link\":\"/06.设计模式/22-解释器模式\"},{\"text\":\"23-访问者模式\",\"link\":\"/06.设计模式/23-访问者模式\"}]}],\"/02.前端技术栈/\":[{\"text\":\"前端\",\"items\":[{\"text\":\"JavaScript\",\"link\":\"/02.前端技术栈/JavaScript\"},{\"text\":\"Html\",\"link\":\"/02.前端技术栈/Html\"}]}],\"/03.工具-部署/\":[{\"text\":\"工具|部署\",\"items\":[{\"text\":\"linux运维笔记\",\"link\":\"/03.工具-部署/linux运维笔记\"},{\"text\":\"常见单词\",\"link\":\"/03.工具-部署/常见单词\"},{\"text\":\"收藏目录\",\"link\":\"/03.工具-部署/收藏目录\"},{\"text\":\"Html\",\"link\":\"/03.工具-部署/window\"},{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"/04.方法论/\":[{\"text\":\"方法论\",\"items\":[{\"text\":\"代码规范\",\"link\":\"/04.方法论/代码规范\"},{\"text\":\"开发流程\",\"link\":\"/04.方法论/开发流程\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}],\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>